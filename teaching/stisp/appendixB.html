<!doctype html>
<html lang="zh-Hant-TW">

<head>
<meta charset="utf-8">

<title>附錄 B - VBA 語法</title>

<meta name="description" content="Tutorial of web design for primer">
<meta name="author" content="Elvis Hsieh">

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
<!-- Favicon-->
<link rel="icon" type="image/x-icon" href="/images/elogo.ico" />

<link rel="stylesheet" href="/revealjs/dist/reset.css">
<link rel="stylesheet" href="/revealjs/dist/reveal.css">
<link rel="stylesheet" href="/revealjs/dist/theme/black.css" id="theme">
<link rel="stylesheet" href="/revealjs/plugin/chalkboard/style.css">
<link rel="stylesheet" href="/revealjs/plugin/customcontrols/style.css">
<link rel="stylesheet" href="/css/custom4revealjs.css">
<!-- Code syntax highlighting -->
<link rel="stylesheet" href="/highlightjs/styles/monokai.min.css">   
<link rel="stylesheet" href="/css/style4font.css">
<!-- Printing and PDF exports -->
<script>
var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /revealjs/print-pdf/gi ) ? '/revealjs/dist/print/pdf.css' : '/revealjs/dist/print/paper.css';
document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>

<!--[if lt IE 9]>
<script src="reveal-js/lib/js/html5shiv.js"></script>
<![endif]-->
</head>
<body>

<div class="reveal">

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">

<section><!--start block-->
<section data-markdown><script type="text/template">
# 附錄 B <br /> VBA 語法簡介
</script></section>
<section data-markdown><script type="text/template">
## Entering VBA code
- you can use a colon(:) to separate multiple instructions on a single line.
- **To use VBA's line continuation sequence**: a space followed by an underscore ( _ ).
- Because **VBA variable names aren't case-sensitive**, **the VBE, by default, adjusts the
names of all variables with the same letters** so that their case matches the case of
letters that you most recently typed.
- The apostrophe(撇號) is the preferred comment indicator, you can also use the **Rem keyword** to mark a line as a comment.
</script></section>
<section data-markdown><script type="text/template">
## Example of VBA code for Entering
<pre><code data-trim data-line-numbers>Sub add()
	
    Dim a, b, c As Integer : a = 1   ' or a% = 1
    dim public as Integer 'error here
    Debug.Print a
    ' open Immediate Window to view the "a" value
    ' WorkSheets.Add().Name = "elvis" to add a worksheet with elvis name
    ' WorkSheets("elvis").Delete to delete elvis worksheet
    b = 2    'or b% = 2
    Debug.Print b
    c = a + b    
    Debug.Print c
    MsgBox "a = " & a & "," & Chr(13) & _
           "b = " & b & vbNewLine & _
           "a + b = " & c  

End Sub</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## MsgBox function
- 語法： MsgBox (prompt, [ buttons, ] [ title, ] [ helpfile, context ])
<pre><code>Dim Msg, Style, Title, Help, Ctxt, Response, MyString
Msg = "Do you want to continue ?"    ' Define message.
Style = vbYesNo Or vbCritical Or vbDefaultButton2    ' Define buttons.
Title = "MsgBox Demonstration"    ' Define title.
Help = "DEMO.HLP"    ' Define Help file.
Ctxt = 1000    ' Define topic context. 
		' Display message.
Response = MsgBox(Msg, Style, Title, Help, Ctxt)
If Response = vbYes Then    ' User chose Yes.
	MyString = "Yes"    ' Perform some action.
Else    ' User chose No.
	MyString = "No"    ' Perform some action.
End If</code></pre>
- Reference to [MsgBox function](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/msgbox-function)
</script></section>
<section data-markdown><script type="text/template">
## Declaring Variables
- Variable names must **start with a letter** and can be up to 255 characters in length.
- Variable name **can’t contain characters such as space, periods, exclamation points, mathematical operators, type-declaration characters** (@, &, $, #)
- To explicitly declare variables in VBA, use the **Dim** statement, followed by the variable name and type.
- If a variable is used without being declared, or if no type is specified, **it will be assigned the type Variant.**
- Use the **Option Explicit** statement on first line of a module to **force all variables to be declared before usage**.
</script></section>
<section data-markdown><script type="text/template">
## Example of Variable Declaration
- Good variable name
	- a , MyVariable, ch02, myVar, Visual_Basic_Editor, VBA, **vbaIntro**, ..., etc	
- Bad variable name
	- **My Variable**—Contains a space
	- **My!Variable**—Contains an exclamation point
	- **Elvis@gmail**—Contains a type-declaration character (@)
	- **02chapter**—Does not start with a letter
	- **a+b**—Contains a mathematical operators
</script></section>
<section data-markdown><script type="text/template">
## [Data Type (資料型態)](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/data-type-summary) 1/3

| Data type | StorageSize | Range |
| :--- | :--- | :--- |
|Boolean 	|2 bytes 		|True or False|
|Byte 	|1 byte 	|0 to 255|
|Currency (scaled integer) 	|8 bytes 	|-922,337,203,685,477.5808 to 922,337,203,685,477.5807|
|Date 	|8 bytes 	|-657,434 (January 1, 100), to 2,958,465 (December 31, 9999)|
|Integer 	|2 bytes 	|-32,768 to 32,767|
|Long (Long integer) 	|4 bytes 	|-2,147,483,648 to 2,147,483,647|
</script></section>
<section data-markdown><script type="text/template">
## [Data Type (資料型態)](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/data-type-summary) 2/3

| Data type | StorageSize | Range |
| :--- | :--- | :--- |
|Double (double-precision floating-point) 	|8 bytes 	|-1.79769313486231E308 to -4.94065645841247E-324 for negative values|
|LongLong (LongLong integer) 	|8 bytes 	|-9,223,372,036,854,775,808 to 9,223,372,036,854,775,807|
LongPtr 	|4 bytes on 32-bit systems| -2,147,483,648 to 2,147,483,647 on 32-bit systems|
|String (variable) 	|10 bytes + string length 	|0 to approximately 2 billion|
|String (fixed) 	|Length of string 	|1 to approximately 65,400|
</script></section>
<section data-markdown><script type="text/template">
## [Data Type (資料型態)](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/data-type-summary) 3/3

| Data type | StorageSize | Range |
| :--- | :--- | :--- |
|**Dictionary** 	|Unknown 	|Unknown|
|**Object** 	|4 bytes 	|Any Object reference|
|Collection 	|Unknown 	|Unknown|
|**Variant** (with numbers) 	|16 bytes 	|Any numeric value up to the range of a Double|
|Variant (with characters) 	|22 bytes + string length (24 bytes on 64-bit systems) 	|Same range as for variable-length String|
|**User-defined** (using Type) 	|Number required by elements 	|The range of each element is the same as the range of its data type.|
</script></section>
<section data-markdown><script type="text/template">
## Why should we set the data type?
- **電腦的程式碼必須載入到記憶體中才能被執行**，但是，當電源關閉，記憶體中的資料全部消失不見，因此，必須要後備儲存體存放資料
- 中央處理器讀取記憶體中的資料，並且執行程式碼，透過**資料型態的宣告，讓電腦知道處理的資料是哪種型態，要配置多少記憶體**？
- 例如：整數資料型態 (Integer)，配置 2 bytes 的記憶體，而不是 4 bytes 的記憶體，
對於工程數值的精確度要求，可以使用更長的資料型態來做計算，以達到精確度要求
- **電腦沒有減法器，整數相減，減數先取補數，兩數相加後再加 1**；例如 10 - 3 = 7, 1010 + 1100,  0110 + 1 = 0111 = 7
</script></section>
<section data-markdown><script type="text/template">
## 電腦處理整數減法
- **減數先取補數，兩數相加後再加 1**
- 例如 10 - 3 = 7, 1010 + 1100 = 0110, 0110 + 1 = 0111 = 7
	- 減數 3, 二進位是 0011, 取補數得 1100
	- 10 的二進位數字是 1010，與 1100 相加得 0110
	- 0110 再加 1 得 0111, 0111 是 7
	- 所以，10 -3 = 7
</script></section>
<section data-markdown><script type="text/template">
## Type-declaration characters
|Character |Data Type of Variable | Example|
|:--- | :--- | :--- |
|% |Integer | Quantity% |
|& |Long |China& |
|@ | Currency |Profits@ |
| ! |Single |temperature! |
|# |Double |Differential# |
| $|String (variable length)| myMessage$|
| | | |
- For example the **implicit declaration of the variable**
	- Quantity% = 10
	- China& = 100
	- myMessage$ = "Hello World"
</script></section>
<section data-markdown><script type="text/template">
## 自訂資料型態
- User-defined data types can contain one or more elements
 of a data type, an array, or **a previously defined user-defined type**.

<pre><code data-trim data-line-numbers>Type employeeInfo 	' Create user-defined type.
    ID As Integer               ' Define elements of data type.
    Name As String * 20
    Address As String * 30
    Phone As Long
    HireDate As Date
End Type
Sub createInfo()
    Dim myInfo As employeeInfo	' Declare variable.
    myInfo.ID = 1234	' Assign a value to an element.
    myInfo.Name = "Elvis Hsieh"
    myInfo.Phone = 928911199
    MsgBox myInfo.ID & myInfo.Name & myInfo.Phone, vbOKOnly, "Personal Information"
End Sub</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## VBA Keywords
- [Keywords of VBA](https://learn.microsoft.com/en-us/office/vba/language/reference/keywords-visual-basic-for-applications)
| | | | ||
|:---|:---|:---|:---|:---|
| As | Binary | ByRef | ByVal |Date |
| Else |Empty |Error |False | For|	
| Friend | Get | Input | Is | Len|	
| Let |Lock | Me | Mid	| New |
| Next |Nothing | Null	| On | Option |
| Optional | ParamArray | Print | Private | Property |
| PtrSafe | Public | Resume | Seek | Set |
| Static | Step | String | Then | Time | 
| To	 | True |WithEvents | | |
| | | | ||
- [Keywords by task](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/keywords-by-task)
and [VB Keywords](https://learn.microsoft.com/en-us/dotnet/visual-basic/language-reference/keywords/)
- vbaIntro.xlsm : b02_declareVar, b03_declareDrill module
</script></section>
<section data-markdown><script type="text/template">
## Boolean data type
- A data type with only two possible values, True (-1) or False (0). 
- Boolean variables are stored as 16-bit (2-byte) numbers
</script></section>
<section data-markdown><script type="text/template">
## EOF function
-  EOF function to detect the end of a file. This example assumes that myFile.txt is a text file with a few lines of text.
<pre><code>Public Sub oneChar()
Dim MyChar
Open "myFile.txt" For Input As #1    ' Open ./myFile.txt file for input.
Do While Not EOF(1)    ' Check for end of file.
	' MyChar = Input(1, #1)  ' Get one character.
	Line Input #1, MyChar    ' Read line of data.
	Debug.Print MyChar    ' Print to the Immediate window.
Loop
Close #1    ' Close file.
End Sub
' myFile.txt contents
' Hi, runner hsieh
' I am a programmer.
</code></pre>
</script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template">
# Cells, Range and Worksheet
</script></section>
<section data-markdown><script type="text/template">
## Cells and Ranges(1/2)
- 請開啟 VBE, **按 Ctrl + G 開啟"即時運算"視窗**，依序輸入下列的語法，按下 Enter
	1. Range("A1:A4").Select ↩
	1. [A1:A4].Value = 55
	2. Range("B1:D4").Value = 30
	3. Selection.ClearContents
	4. Cells.ClearContents
	5. ActiveCell.Select
	6. ?Selection.Address
	7. Print ActiveWorkbook.Name
</script></section>
<section data-markdown><script type="text/template">
## Cells and Ranges(2/2)
- 上一張投影片輸入語法以後得到的結果依序為
	1. Excel 儲存格 $A$1:$A$4 呈現被選擇的區域，顏色為灰白色(Range("A1:A4").Select)
	2. Excel 儲存格 $A$1:$A$4 資料為 55([A1:A4].Value)
	3. Excel 儲存格 $B$1:$D$4 資料為 30(Range("B1:D4").Value)
	4. Excel 儲存格 $A$1:$A$4 資料清除(Selection.ClearContents)
	5. Excel 儲存格所有資料被清除(Cells.ClearContents)
	6. 詢問目前選擇儲存格的位置(?Selection.Address)，顯示 $\text{\textdollar A}\text{\textdollar 1}$
	7. 尋問目前活頁簿的名稱(Print ActiveWorkbook.Name)，例如 vbaIntro.xlsm
</script></section>
<section data-markdown><script type="text/template">
## Try it by yourself
- **Alt + 向右鍵：開啟 Auto complete**
- **Tab 鍵：完成 Auto complete 的選擇**
	1. 輸入 de 然後按 Alt + 向右鍵(開啟 auto complete)，再按 Tab 鍵，完成 debug 指令
	2. 在 debug 後面輸入 . 然後選擇 print，再按 Tab 鍵，完成 debug.print 指令
	3. 按空白鍵以後，再輸入 ac 然後按 Alt + 向右鍵選擇 ActiveSheet
	4. 再輸入 .name 然後按 Enter
</script></section>
<section data-markdown><script type="text/template">
## Cells Operation
- Cells start with cells(1, 1)
<pre><code>Cells(4, 2).Value = 10
'Cells(0, 0).Value = 20 ' error here, starting with cells(1,1)
Cells(1, 3).Value = 30</code></pre>
- Cells (4, 2) is the same with Cells(4, B) in Excel
- Using **Evaluate function** to set the cells value
<pre><code>Application.Evaluate("a3") = "HelloWorld!"
[a4] = "elvis hsieh" ' the same as above code
[a5] = "Sum(B1:C4)"</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Range format instructions
- 設定 Range 儲存格內的字型、字型大小及顏色等 
<pre><code>Sheets.Add.name = "test"
Range("a4:d9").value = "中華文字之美"
Range("a4:d9").Font.Name = "標楷體"
Range("a4:d9").Font.Size = 20
Range("a4:d9").Font.Color = RGB(255,0,0)
Range("a4:d9").Columns.AutoFit
Range("a4:d9").Interior.Color = RGB(204,255,255)
Range("a4:d9").ClearFormats
Sheets("test").Delete
</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Range Operation(1/3)
- Line 10 Range("C1:C10 B5:E5") 是 C1:C10, B5:E5 交叉範圍
<pre><code data-trim data-line-numbers>Public Sub rang()
Cells.Clear
Worksheets("elvis").Range("A1").Value = 6
	Worksheets("elvis").Range("B1").Value = 25
	ActiveSheet.Range("A6:C10").Value = 2
	Range("A2", "B3").Select
	Range("A2", "B3") = 56
	Range("C1:C10 B5:E5").Select
	Range("C1:C10 B5:E5") = 3
	Range("C1:C10").Interior.Color = RGB(200, 255, 255)
	Range("B5:E5").Interior.Color = RGB(255, 200, 255)
	Range("F1,F3,F5,F7,F9").Select
	Range("F1,F3,F5,F7,F9") = 67
	ActiveCell.Range("C2") = 5      ' ActiveCell become A1
	Range("D1:K10").Cells(4).Interior.Color = RGB(210, 220, 2)
	Range("D1:K10").Cells(4) = 2000
	Range("D1:K10").Select
	Range("A1").Select
End Sub</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Range Operation(2/3)
<pre><code data-trim data-line-numbers>Public Sub rangDirection() '請一步一步執行 subDirection 子程式
Call rang
Range("A1:A2").Select
Range("A1:A2").Offset(3, 2).Select ' move down 3, right 2
Range("F5:H5").Select
Range("F5:H5").Offset(-1, -4).Select
Range("B2:D3").Select
Range("B2:D3").Offset(5).Select
Range("D1:E4") = 20
Range("E3").End(xlDown).Select 'E3 is not empty, E4 is the end of cell.
Range("C3").End(xlDown).Select 'C3 is empty, C5 is the end of cell.
rowNumber = Range("C3").End(xlDown).Row 'row number
Debug.Print rowNumber
Range(Range("C3"), Range("C5").End(xlDown)).Select 'Select C3
cRowCount = Range(Range("C3"), Range("C5").End(xlDown)).Count
Debug.Print cRowCount 'count cells from C3 to C.End
Range(ActiveCell, ActiveCell.End(xlDown)).Select
Range("A1").End(xlToRight).Select
rightCount = Range("A1").End(xlToRight).Column 'count cells from A1 to end of column
Range("A1").End(xlToRight).Next.Select
Debug.Print rightCount
End Sub</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Range Operation(3/3)
- [Range is a object](https://learn.microsoft.com/zh-tw/office/vba/api/excel.range(object)) which have many method and properties.
<pre><code data-trim data-line-numbers>Set wb = ThisWorkbook
Set ws = wb.Worksheets(2) 'the second "elvis" sheet
Set rg = ws.range("D1:E4")
Debug.Print rg.Address
' run the below code step by step
For i = 1 To 8
	rg.Cells(i) = i
Next i
Dim rValue As Integer ' change rValue into rvalue for testing case-sensitive
rValue = 8
For j = 1 To 4
	For k = 1 To 2
		rg.Cells(j, k) = rValue
		rValue = rValue - 1
	Next k
Next j</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Using Name Manager(1/5)
- 選取 E2:E8 範圍 >> 公式 >> 定義名稱 >> 指定"名稱"及"範圍"
![](/images/stisp/nameManager.png)
</script></section>
<section data-markdown><script type="text/template">
## Using Name Manager(2/5)
- 設定 Total 名稱
![](/images/stisp/nameManager2.png)
</script></section>
<section data-markdown><script type="text/template">
## Using Name Manager(3/5)
- 選取 G4 儲存格範圍
![](/images/stisp/nameManager3.png)
</script></section>
<section data-markdown><script type="text/template">
## Using Name Manager(4/5)
- 設定 Total_Max 名稱
![](/images/stisp/nameManager4.png)
</script></section>
<section data-markdown><script type="text/template">
## Using Name Manager(5/5)
- 修改名稱可以點選「名稱管理員」來編輯
![](/images/stisp/nameManager5.png)
</script></section>
<section data-markdown><script type="text/template">
## Using Name Manager in VBA Code
<pre><code data-trim>Public Sub rangeMaxMin()
	Dim ws As Worksheet
	Set ws = ThisWorkbook.Worksheets("product")
	Dim rag As Range
	Dim val As Integer

	Set rag = ws.Names("Total").RefersToRange
	'val = WorksheetFunction.Max(rag)
	'Debug.Print val
	Worksheets("product").Range("Total_Max").Value = WorksheetFunction.Max(rag)
	Worksheets("product").Range("Total_Min").Value = WorksheetFunction.Min(rag)
End Sub</code></pre>
- 在 E2:E8 指定的 Total 名稱內找出最大值與最小值，分別存入命名為 Total_Max 與 Total_Min 的儲存格內
</script></section>
<section data-markdown><script type="text/template">
## Worksheet Operation(1/2)
- Copy Worksheet to New Workbook
<pre><code>Sheets("Sheet_name").Copy
ActiveWorkbook.Sheets("Sheet_name").Copy
ActiveSheet.Copy</code></pre>
- Copy Sheet Within the Same Workbook
<pre><code>'copy into Sheet_name2 before
Sheets("Sheet_name1").Copy Before:=Sheets("Sheet_name2")
'copy into fist sheet before
Sheets("Sheet_name1").Copy Before:=Sheets(1)
'copy to last sheet after
Sheets("Sheet_name1").Copy After:=Sheets(Sheets.Count)</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Worksheet Operation(2/2)
- Copy Worksheet to Another Workbook
<pre><code data-trim data-line-numbers>'將 Sheet1 工作表複製到 Example.xlsm 工作簿的第一個工作表之前
Sheets("Sheet1").Copy Before:=Workbooks("Example.xlsm").Sheets(1)
'將 Sheet1 工作表複製到 Example.xlsm 工作簿的最後一個工作表之後
Sheets("Sheet1").Copy After:=Workbooks("Example.xlsm").Sheets(Workbooks("Example.xlsm").Sheets.Count)</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## [With Statement](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/with-statement)(敘述)
- [This is a code](#/1/5) that we have seen it before. 
- We can recode it by With statement as following
<pre><code>With Range("a4:d9")
	.value = "中華文字之美"
	.Font.Name = "標楷體"
	.Font.Size = 20
	.Font.Color = RGB(255,0,0)
	.Columns.AutoFit
	.Interior.Color = RGB(204,255,255)
	.ClearFormats
End With </code></pre>
- 請同學開啟任何一個工作表及 VBE，建立一個 sub，將程式碼複製並貼上到 sub 中，執行這個 sub 程式並觀察結果
</script></section>
<section data-markdown><script type="text/template">
## With Statement Usage
- Using With Statement in User define data type
<pre><code data-trim data-line-numbers>Private Type productLists
    ID As Integer
    Name As String
    Amount As Integer
    Price As Integer
End Type
Public sub withUsage()
 Dim myProduct As productLists
	With myProduct
			.ID = c.Offset(0, -1).Value
			.Name = c.Value
			.Amount = c.Offset(0, 1).Value
			.Price = c.Offset(0, 2).Value
	End With
	' .....
End sub</code></pre>
</script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template">
# Object, Method, Property and Event
</script></section>
<section data-markdown><script type="text/template">
## What is an object?
- An object represents an element of an application, such as **a worksheet, a cell, a chart, a form, or a report**.
- You can apply one of the object's **methods or change the value of one of its properties**.
- 使用 dot(.) 來呼叫物件的方法(method)或屬性(property)
- For example
	- Range 是一個物件, Range("A1:A4").Select 語法是使用 Range 物件的 Select 方法，選取指定的 A1:A4 區域
	- Selection.ClearContents method 把目前 Selection 區域的資料清除
</script></section>
<section data-markdown><script type="text/template">
## Object heirarchy
![](/images/stisp/objects.png)
</script></section>
<section data-markdown><script type="text/template">
## Chart(圖表) Object(1/3)
- 點選任何一個工作表 >> 按滑鼠右鍵 >> 插入
![](/images/stisp/chartInsert.png)
</script></section>
<section data-markdown><script type="text/template">
## Chart(圖表) Object(2/3)
- 點選「圖表」 >> 按下「確定」按鈕
![](/images/stisp/chartInsert2.png)
</script></section>
<section data-markdown><script type="text/template">
## Chart(圖表) Object(2/3)
![](/images/stisp/chartInsert3.png)
</script></section>
<section data-markdown><script type="text/template">
## Method, Property and Event
- **A method is an action that an object can perform(可執行的動作)**. For example, ClearContents method 清除資料
- **A property is an attribute of an object** that defines one of the object's characteristics, such as **size, color, or screen location**, or an aspect of its behavior, such as whether it is enabled or visible.
	- for example, Range("a1:a4").Font.Size = 20, Range("A1:A4").Interior.Color = RGB(255,0,0) 
- An event is an action recognized by an object, **such as clicking the mouse or pressing a key**, and for which you can write code to respond.
</script></section>
<section data-markdown><script type="text/template">
## [Chart object events](https://learn.microsoft.com/en-us/office/vba/excel/concepts/events-worksheetfunctions-shapes/chart-object-events)(1/2)
| Event | Description |
| :--- | :--- |
| Activate | Occurs when the Chart is activated. |
| BeforeDoubleClick | Occurs when the Chart is DoubleClick before. |
| BeforeRightClick | Occurs when the Chart is RightClick before. |
| Calculate	| Occurs when the Chart is recalculated. |
| Deactivate | Occurs when the Chart is deactivated. |
| MouseDown | Occurs when the Chart is MouseDown. |
| MouseMove | Occurs when the Chart is MouseMove. |
| MouseUp	| Occurs when the Chart is MouseUp. |
| Resize | Occurs when the Chart is resized. |
| Select | Occurs when the Chart is selected. |
| SeriesChange | Occurs when the Chart Series is changed. |
</script></section>
<section data-markdown><script type="text/template">
## Chart object events(2/2)
![](/images/stisp/chartEvent.png)
</script></section>
<section data-markdown><script type="text/template">
## [Worksheet object events](https://learn.microsoft.com/en-us/office/vba/excel/concepts/events-worksheetfunctions-shapes/worksheet-object-events)
![](/images/stisp/worksheetEvent.png)
</script></section>
<section data-markdown><script type="text/template">
## Calculate Worksheet events
- 開啟 Sheet1 工作表，然後按下 Ctrl + Alt + F9，執行計算
<pre><code data-trim data-line-numbers>Private Sub Worksheet_Calculate()
    Dim retY As String
    retY = MsgBox("It will autofit columns of cells in Sheets1", vbYesNo, "Calculate event Information")
    If retY = vbYes Then
        ' adjusts the size of columns A through F when Ctrl + Alt + F9 to reload function
        Columns("A:F").AutoFit
        Cells.Font.Name = "標楷體"
        Call b05_setStyle.cellFormat(ActiveSheet.Name)
    Else
        MsgBox "it didn't do anything.", vbExclamation, "Calculate event Information"
    End If
End Sub</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Change Worksheet events
- 修改 A1 儲存格的數值，按下 Enter 以後，游標會往右移動
- 若 A1 儲存格的數值改變成"空值"，則游標才會往下移動(正確的移動)
<pre><code data-trim data-line-numbers>Private Sub Worksheet_Change(ByVal Target As Range)
    If Target.Address = "$A$1" Then
        If IsEmpty(Range("A1").Value) = True Then
            Application.MoveAfterReturnDirection = xlDown
        Else
            Application.MoveAfterReturnDirection = xlToRight
            Target.Offset(, 1).Select
        End If
    End If
End Sub
</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## SelectionChange events
- 當 A1 儲存格的數值是"空值"，選擇 A:E 範圍內的儲存格，按下 Enter 以後，則游標才會往下移動(正確的移動)
- A1 儲存格不是空值，按下 Enter 以後，游標會往右格移動
- 否則 A1 儲存格不是空值，選擇 A:E 範圍以外的儲存格，游標會往下 1 格，往左 5 格移動(offset(1,-5))
<pre><code data-trim data-line-numbers>Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    If IsEmpty(Range("A1").Value) = True Then
        Application.MoveAfterReturnDirection = xlDown
    Else
        If Not Intersect(Target, Me.Range("a:e")) Is Nothing Then
            Application.MoveAfterReturnDirection = xlToRight
        Else
            Application.MoveAfterReturnDirection = xlDown
            Target.Offset(1, -5).Select
        End If
    End If
End Sub</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## [Form and ActiveX Controls](https://support.microsoft.com/en-us/office/overview-of-forms-form-controls-and-activex-controls-on-a-worksheet-15ba7e28-8d7f-42ab-9470-ffb9ab94e7c2) 
![](/images/stisp/control.png)
</script></section>
<section data-markdown><script type="text/template">
## Form Controls
![](/images/stisp/formControl.png)
</script></section>
<section data-markdown><script type="text/template">
## AtciveX Controls
![](/images/stisp/xControl.png)
</script></section>
<section data-markdown><script type="text/template">
## AtciveX Controls Event
![](/images/stisp/xControlEvent.png)
- Click event to Call hwOne() sub in assignment1 Module
</script></section>
<section data-markdown><script type="text/template">
## Worksheets, Sheets and Charts
- Worksheets, Sheets and Charts objects name are not the same
<pre><code>Public Sub chartSh()
    Dim wb As Workbook
    Set wb = ThisWorkbook
    Debug.Print wb.Worksheets(1).Name
    Debug.Print wb.Sheets(1).Name
    Debug.Print wb.Charts(1).Name
	' The result is "Sheet1" "Chart1" "Chart1", if Chart1 in the first sheet
End Sub</code></pre>
</script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template">
# Array
</script></section>
<section data-markdown><script type="text/template">
## Array(1/6)
- For **each single value** that you wanted your procedure to manipulate, **you declared a variable**.
- But what **if you have a series of values**? 
You would have to create enough variables to handle all the data.
- **An array is a group of elements of the same type that have a common name.** You refer to a
specific element in the array by **using the array name and an index number**.
- For example, you can define an array of 12 string variables so that each variable corresponds to the
name of a month. You can refer to the first element
of **the array as monthNames(0), the second element as monthNames(1), and so on, up to monthNames(11)**.
</script></section>
<section data-markdown><script type="text/template">
## Arrays(2/6)
- When you declare an array, you need to **specify only the upper index**, in which case VBA assumes that **0 is the lower index**.
- The two statements that follow have the same effect
<pre><code>Dim monthNames(11) As String
Dim monthNames(1 to 12) As String
</code></pre>
- **If you would like VBA to assume that 1 is the lower index** for all arrays that declare only 
the upper index, include the following statement before any procedures in your module:
 <code>Option Base 1</code>
</script></section>
<section data-markdown><script type="text/template">
## Arrays(3/6)
- One-dimensional array
<pre><code>Dim arrayDirect1D(2) As String
arrayDirect(0) = "A"
arrayDirect(1) = "B"
arrayDirect(2) = "C"</code></pre>

- Notice that you don’t specify the number of elements between the parentheses.
Next, **use the Array function as shown here to assign values to monthNames**
<pre><code>monthNames = Array("January", "February", "March", "April", "May", "June", & _
	"July", "August", "September", "October", "November", "December")
</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Arrays(4/6)
- Two-dimensional array
<pre><code>Dim myArray(1 To 100, 1 to 50) As Integer '100x50 Row x Column
Dim myArray(0 To 100, 0 To 50) As Integer ' 101x51 elements
Dim myArray(100,50) As Integer ' 101x51 elements
</code></pre>
- Multi-dimensional array
<pre><code>Dim arrayDirectMulti(1, 1, 2) As String '2x2x3 = 12 elements
arrayDirectMulti(0, 0, 0) = "A"
arrayDirectMulti(0, 0, 1) = "B"
arrayDirectMulti(0, 0, 2) = "C"
arrayDirectMulti(0, 1, 0) = "D"</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Arrays(5/6)
- Using Array() function
<pre><code>Dim array1D As Variant 'has to be type variant
array1D = Array(1, 2, "A")
'-> array1D(0) = 1, array1D(1) = 2, array1D(2) = "A"</code></pre>
- From range
<pre><code>Dim arrayRange As Variant 'has to be type variant
arrayRange = Range("A1:C10").Value
'-> arrayRange(1,1) = value in A1
'-> arrayRange(1,2) = value in B1
'-> arrayRange(5,3) = value in C5</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Arrays(6/6)
- From range(**Range("A1:C10").Value**)
	- Putting ranges in an array **always creates a 2D array** (even if only 1 row or column)
	- **Starting at 1 and not 0, first dimension is the row** and the second the column
|  | A | B | C |
| :---: | :---: | :---: | :---: |
| 2 | (1,1) | (1,2) | (1,3) |
| 3 | (2,1) | (2,2) | (2,3) |
| 4 | (3,1) | (3,2) | (3,3) |
| 5 | (5,1) | (5,2) | (5,3) |
| ... | ... | ... | ... |
| 10 | (10,1) | (10,2) | (10,3) |
| | | | |
</script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template">
# Sub and function
</script></section>
<section data-markdown><script type="text/template">
## Call function or Sub
- Call function in the same sheet or module
	- Call mySub_Name
	- myFunction_Name
- Call function from another sheet or module
	- Call sheetName.MySub_Name
	- moduleName.MyFunction_Name
- Call function from another workbook
	- add-in name: VBAsProject
	- Call YourProject.YourModule.YourSub
</script></section>
<section data-markdown><script type="text/template">
## Example for Call sub or function
<pre><code data-trim data-line-numbers>Dim retString As String 'Global variable
Public Sub main()
	Dim funcRetString As String
	Call subProg("Hi, Simon.") 'call sub without return
	Call subProg("Hi, elvis hsieh. How are you?") 'call sub with return
	Debug.Print retString 'set return value is a global variable
	'Function call
	funcProg ("Hi, Sam Lee, Are you living in Taiwan?") 'function call without return
	funcRetString = funcProg("Hi, Jenny Wang, Are you going to shopping now?") 'function call with return
	Debug.Print funcRetString
End Sub
Public Sub subProg(ByRef aName As String) 'ByRef is like a reference which can be changed with sub or function
	retString = "Hi, runner chen. I am fine, and you?"
End Sub
Public Function funcProg(ByVal anName As String) 'ByVal will copy anName to this function parameter	
	Dim retMessage As String
	Debug.Print anName	
	retMessage = "Yes, I am."
	funcProg = retMessage
End Function</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Sub vs Function
- **A VBA Function is a procedure that performs calculations and returns a value**. **You can use these
functions** in your Visual Basic for Applications (VBA) code or **in worksheet formulas**.
- **You can think of a Sub procedure as a command** that either the user or another procedure can execute.
- **Function procedures**, on the other hand, **usually return a single value (or an array)**, **just like** Excel worksheet
functions and **VBA built-in functions**.
</script></section>
<section data-markdown><script type="text/template">
## User Defined Functions 
- **User Defined Functions(UDFs) can be created by the user**.
<pre><code>'ByVal will copy anName to this function parameter
Public Function funcProg(ByVal anName As String)
	Dim retMessage As String
	Debug.Print anName
	retMessage = "Yes, I am."
	funcProg = retMessage
End Function</code></pre>
- Input =function_name(arg1,arg2, ...) in a Cell of Worksheet.
</script></section>
<section data-markdown><script type="text/template">
## Call C++ dll library
<pre><code data-trim data-line-numbers>Declare PtrSafe Function CppSum Lib "D:\Teaching\MISproject\src\cppLib\vbaInterface.dll" ( _
ByRef Nums As Long, ByVal N As Long) As Long

Public Sub callCppFunction()
	Dim Arr() As Long
	ReDim Arr(0 To 4)
	Arr(0) = 1
	Arr(1) = 2
	Arr(2) = 3
	Arr(3) = 4
	Arr(4) = 5
	Dim ArrSize As Long
	ArrSize = UBound(Arr) - LBound(Arr) + 1

	Dim Result As Long
	Result = CppSum(Arr(LBound(Arr)), ArrSize)

	'Debug.Print Result
	MsgBox "The result is: " & Result, vbOKOnly, "Call CPP Funtion"
End Sub</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## C++ source code(1/2)
<pre><code data-trim data-line-numbers>// C++ interface for VBA
// filename: vbaInterface.cpp
// clang++ vbaInterface.cpp -shared -o vbaInterface.dll

#include "vbaInterface.hpp"

DLLExport int __stdcall CppRectangleArea(RECTANGLE* rect) {
	return rect->s1 * rect->s2;
}
DLLExport int __stdcall CppSum(int nums[], int n) {
	int theSum = 0;
	for (int i = 0; i < n; ++i) {
		theSum += nums[i];
	}
	return theSum;
}</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## C++ source code(2/2)
<pre><code data-trim data-line-numbers>// C++ interface for VBA
// filename: vbaInterface.hpp
#ifndef VBA_INTERFACE_H
#define VBA_INTERFACE_H
#define DLLExport __declspec(dllexport)

struct RECTANGLE {
	int s1;
	int s2;
};

#ifdef __cplusplus
extern "C" {
#endif

DLLExport  __stdcall  int CppRectangleArea(RECTANGLE* rect);
DLLExport  __stdcall int CppSum(int nums[], int n);
	
#ifdef __cplusplus
}
#endif // __cplusplus

#endif // VBA_CPP_H</code></pre>
</script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template">
# 自訂表單
</script></section>
<section data-markdown><script type="text/template">
## 表單製作
- BackColor
	- BackColor 可以使用預設的顏色或者圖檔作為背景顏色
	- 預設顏色可以在顏色表格中白色區域按下滑鼠右鍵，開啟選擇顏色視窗，選擇想要的顏色
	- 圖檔的格式必須是點矩陣圖檔，例如 .jpg, .jpeg, .bmp, .gif
	- **PictureSizeMode 可以調整背景圖檔的樣式**
- Font, FontSize, FontColor 請自行調整
- Caption 是表單的標題文字
- Name 是表單的名稱，請修改成自己想要的名稱
- **ShowModel 請設定為 False**，在工作表內才可以點選儲存格
</script></section>
<section data-markdown><script type="text/template">
## 表單控制項
- Label
	- Label 設定標籤文字，請修改成自己想要的文字
	- Label 沒有垂直置中的調整選項，**請使用 2 個 Label 來調整垂直置中**
- TextBox
	- TextBox 輸入文字方塊，**請修改成自己想要的名稱**
	- 可以**使用對齊、調整大小來調整文字方塊與 Label 的位置與大小**
- **ComboBox**
	- SourceRow 為下拉式選單的列數
	- offset(reference, row, column,[hight], [width])
	- 公式 >> 定義名稱 >> pName >> 為下拉式選單擷取儲存格資料的範圍
	- =OFFSET(product!$B$1:$B$9999,1,,COUNTA(product!$B$1:$B$9999)-1,1)
</script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template">
# Find Method
</script></section>
<section data-markdown><script type="text/template">
## [Find Method](https://learn.microsoft.com/en-us/office/vba/api/excel.range.find)(1/4)
- Syntax
	- **expression.Find**(What, After, LookIn, LookAt, SearchOrder, SearchDirection, MatchCase, MatchByte, SearchFormat)
	- **expression A variable that represents a Range object**.
- Parameters
|Name |R/O |	D.T. |	Description |
|:--- | :--- | :--- | :--- |
|What |Required |Variant |The data to search for. Can be a string or any Microsoft Excel data type. |
|After |Optional |Variant |The cell after which you want the search to begin. This corresponds to the position of the active cell when a search is done from the user interface.|
| | | | |
</script></section>
<section data-markdown><script type="text/template">
## Find Method(2/4)
- **Notice that After must be a single cell in the range**. Remember that the search begins after this cell; the specified cell isn't searched until the method wraps back around to this cell.
- Parameters
|Name |R/O |	D.T. |	Description |
|:--- | :--- | :--- | :--- |
|LookIn |Optional |Variant |Can be one of the following XlFindLookIn constants: xlFormulas, xlValues, xlComments, or xlCommentsThreaded. |
|LookAt |Optional |Variant |Can be one of the following XlLookAt constants: xlWhole or xlPart. |
| | | | |
</script></section>
<section data-markdown><script type="text/template">
## Find Method(3/4)
- Parameters
|Name |R/O |	D.T. |	Description |
|:--- | :--- | :--- | :--- |
| SearchOrder |Optional |	Variant |	Can be one of the following XlSearchOrder constants: xlByRows or xlByColumns. |
| SearchDirection |	Optional |	Variant |	Can be one of the following XlSearchDirection constants: xlNext or xlPrevious. |
| MatchCase |	Optional |	Variant |	True to make the search case-sensitive. The default value is False. |
| | | | |
</script></section>
<section data-markdown><script type="text/template">
## Find Method(4/4)
- Parameters
|Name |R/O |	D.T. |	Description |
|:--- | :--- | :--- | :--- |
| MatchByte  |	Optional |	Variant |	Used only if you have selected or installed double-byte language support. True to have double-byte characters match only double-byte characters. False to have double-byte characters match their single-byte equivalents.|
| SearchFormat | 	Optional |	Variant |	The search format.|
| | | | |
- Return value
	- **A Range object that represents the first cell** where that information is found.
</script></section>
<section data-markdown><script type="text/template">
# Error handling
</script></section>
<section data-markdown><script type="text/template">
## Error handling(1/2)
| Item	| Description|
|:--- |:---|
| On Error Goto 0 |	When error occurs, the code stops and displays the error.|
|On Error Goto -1 |	Clears the current error setting and reverts to the default.|
|On Error Resume Next |	Ignores the error and continues on.|
| On Error Goto [Label]	| Goes to a specific label when an error occurs. This allows us to handle the error.|
|Err Object	 | When an error occurs the error information is stored here.|
</script></section>
<section data-markdown><script type="text/template">
## Error handling(2/2)
| Item	| Description|
|:--- |:---|
|Err.Number	| The number of the error.(Only useful if you need to check a specific error occurred.)|
|Err.Description |	Contains the error text.|
|Err.Source	| You can populate this when you use Err.Raise.|
|Err.Raise	| A function that allows you to generate your own error.|
|Error Function	| Returns the error text from an error number.|
| | Obsolete. |
| Error Statement	| Simulates an error. Use Err.Raise instead.|
</script></section>

</section><!--end block-->
	
</div>
</div>

<script src="/revealjs/lib/js/head.min.js"></script>
<script src="/revealjs/dist/reveal.js"></script>
<script src="/revealjs/plugin/zoom/zoom.js"></script>
<script src="/revealjs/plugin/notes/notes.js"></script>
<script src="/revealjs/plugin/search/search.js"></script>
<script src="/revealjs/plugin/markdown/markdown.js"></script>
<script src="/revealjs/plugin/highlight/highlight.js"></script>
<script src="/revealjs/plugin/menu/menu.js"></script>
<script src="/revealjs/plugin/math/math.js"></script>
<script src="/revealjs/plugin/chalkboard/plugin.js"></script>
<script src="/revealjs/plugin/customcontrols/plugin.js"></script>
<script src="/revealjs/plugin/animate/svg.min.js"></script>
<script src="/revealjs/plugin/animate/plugin.js"></script>

<script>
Reveal.initialize({
controls: true,
progress: true,
history: true,
center: true,
slideNumber: true,
mouseWheel: true,
transition: 'fade', // none/fade/slide/convex/concave/zoom

menu: {
	side: 'left',
	width: 'normal',
	numbers: false,
	titleSelector: 'h1, h2, h3, h4, h5, h6',
	useTextContentForMissingTitles: false,
	hideMissingTitles: false,
	markers: true,
	custom: true,
	themes: true,
	themesPath: '/revealjs/dist/theme/',
	transitions: true,
	openButton: true,
	openSlideNumber: false,
	keyboard: true,
	sticky: false,
	autoOpen: true,
	delayInit: false,
	openOnInit: false,
	loadIcons: true,
	
	custom: [
			{ title: 'TOC', icon: '<i class="fa fa-external-link-alt">', src: 'links.html' },
			{ title: 'About', icon: '<i class="fa fa-info">', content: '<p>Slides for teaching Office Suite Softwar</p>' }
	]
},

customcontrols: {
	controls: [
	{
		id: 'toggle-overview',
		title: 'Toggle overview (O)',
		icon: '<i class="fa fa-th"></i>',
		action: 'Reveal.toggleOverview();'
	},
	{ icon: '<i class="fa fa-pen-square"></i>',
		title: 'Toggle chalkboard (B)',
		action: 'RevealChalkboard.toggleChalkboard();'
	},
	{ icon: '<i class="fa fa-pen"></i>',
		title: 'Toggle notes canvas (C)',
		action: 'RevealChalkboard.toggleNotesCanvas();'
	}
	]
},

toolbar: {
	// Specifies where the toolbar will be shown: 'top' or 'bottom'
	position: 'bottom',

	// Add button to toggle fullscreen mode for the presentation
	fullscreen: true,

	// Add button to toggle the overview mode on and off
	overview: true,

	// Add button to pause (hide) the presentation display
	pause: true,

	// Add button to show the speaker notes
	notes: false,

	// Add button to show the help overlay
	help: false,

	// If true, the reveal.js-menu will be moved into the toolbar.
	// Set to false to leave the menu on its own.
	captureMenu: true,

	// If true, the playback control will be moved into the toolbar.
	// This is only relevant if the presentation is configured to autoSlide.
	// Set to false to leave the menu on its own.
	capturePlaybackControl: true,

	// By default the menu will load it's own font-awesome library
	// icons. If your presentation needs to load a different
	// font-awesome library the 'loadIcons' option can be set to false
	// and the menu will not attempt to load the font-awesome library.
	loadIcons: true
},

// Optional reveal.js plugins
plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight, RevealAnimate, RevealMenu, RevealCustomControls, RevealChalkboard, RevealMath.KaTeX ],

dependencies: [
//{ src: '/revealjs/plugin/toolbar/toolbar.js' }
]
});

</script>

</body>
</html>
