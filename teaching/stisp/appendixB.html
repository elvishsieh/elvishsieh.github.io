<!doctype html>
<html lang="zh-Hant-TW">

<head>
<meta charset="utf-8">

<title>附錄 B - VBA 語法</title>

<meta name="description" content="Tutorial of web design for primer">
<meta name="author" content="Elvis Hsieh">

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
<!-- Favicon-->
<link rel="icon" type="image/x-icon" href="/images/elogo.ico" />

<link rel="stylesheet" href="/revealjs/dist/reset.css">
<link rel="stylesheet" href="/revealjs/dist/reveal.css">
<link rel="stylesheet" href="/revealjs/dist/theme/black.css" id="theme">
<link rel="stylesheet" href="/revealjs/plugin/chalkboard/style.css">
<link rel="stylesheet" href="/revealjs/plugin/customcontrols/style.css">
<link rel="stylesheet" href="/css/custom4revealjs.css">
<!-- Code syntax highlighting -->
<link rel="stylesheet" href="/highlightjs/styles/monokai.min.css">   
<link rel="stylesheet" href="/css/style4font.css">
<!-- Printing and PDF exports -->
<script>
var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /revealjs/print-pdf/gi ) ? '/revealjs/dist/print/pdf.css' : '/revealjs/dist/print/paper.css';
document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>

<!--[if lt IE 9]>
<script src="reveal-js/lib/js/html5shiv.js"></script>
<![endif]-->
</head>
<body>

<div class="reveal">

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">

<section><!--start block-->
<section data-markdown><script type="text/template">
# 附錄 B <br /> VBA 語法簡介
</script></section>
<section data-markdown><script type="text/template">
## Entering VBA code
- you can use a colon(:) to separate multiple instructions on a single line.
- **To use VBA's line continuation sequence**: a space followed by an underscore ( _ ).
- Because **VBA variable names aren't case-sensitive**, **the VBE, by default, adjusts the
names of all variables with the same letters** so that their case matches the case of
letters that you most recently typed.
- The apostrophe(撇號) is the preferred comment indicator, you can also use the **Rem keyword** to mark a line as a comment.
</script></section>
<section data-markdown><script type="text/template">
## Example of VBA code for Entering
<pre><code data-trim data-line-numbers>Sub add()
	
    Dim a, b, c As Integer : a = 1   ' or a% = 1
    dim public as Integer 'error here
    Debug.Print a
    ' open Immediate Window to view the "a" value
    ' WorkSheets.Add().Name = "elvis" to add a worksheet with elvis name
    ' WorkSheets("elvis").Delete to delete elvis worksheet
    b = 2    'or b% = 2
    Debug.Print b
    c = a + b    
    Debug.Print c
    MsgBox "a = " & a & "," & Chr(13) & _
           "b = " & b & vbNewLine & _
           "a + b = " & c  

End Sub</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Declaring Variables
- Variable names must **start with a letter** and can be up to 255 characters in length.
- Variable name **can’t contain characters such as space, periods, exclamation points, mathematical operators, type-declaration characters** (@, &, $, #)
- To explicitly declare variables in VBA, use the **Dim** statement, followed by the variable name and type.
- If a variable is used without being declared, or if no type is specified, **it will be assigned the type Variant.**
- Use the **Option Explicit** statement on first line of a module to **force all variables to be declared before usage**.
</script></section>
<section data-markdown><script type="text/template">
## Example of Variable Declaration
- Good variable name
	- a , MyVariable, ch02, myVar, Visual_Basic_Editor, VBA, **vbaIntro**, ..., etc	
- Bad variable name
	- **My Variable**—Contains a space
	- **My!Variable**—Contains an exclamation point
	- **Elvis@gmail**—Contains a type-declaration character (@)
	- **02chapter**—Does not start with a letter
	- **a+b**—Contains a mathematical operators
</script></section>
<section data-markdown><script type="text/template">
## [Data Type (資料型態)](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/data-type-summary) 1/3

| Data type | StorageSize | Range |
| :--- | :--- | :--- |
|Boolean 	|2 bytes 		|True or False|
|Byte 	|1 byte 	|0 to 255|
|Currency (scaled integer) 	|8 bytes 	|-922,337,203,685,477.5808 to 922,337,203,685,477.5807|
|Date 	|8 bytes 	|-657,434 (January 1, 100), to 2,958,465 (December 31, 9999)|
|Integer 	|2 bytes 	|-32,768 to 32,767|
|Long (Long integer) 	|4 bytes 	|-2,147,483,648 to 2,147,483,647|
</script></section>
<section data-markdown><script type="text/template">
## [Data Type (資料型態)](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/data-type-summary) 2/3

| Data type | StorageSize | Range |
| :--- | :--- | :--- |
|Double (double-precision floating-point) 	|8 bytes 	|-1.79769313486231E308 to -4.94065645841247E-324 for negative values|
|LongLong (LongLong integer) 	|8 bytes 	|-9,223,372,036,854,775,808 to 9,223,372,036,854,775,807|
LongPtr 	|4 bytes on 32-bit systems| -2,147,483,648 to 2,147,483,647 on 32-bit systems|
|String (variable) 	|10 bytes + string length 	|0 to approximately 2 billion|
|String (fixed) 	|Length of string 	|1 to approximately 65,400|
</script></section>
<section data-markdown><script type="text/template">
## [Data Type (資料型態)](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/data-type-summary) 3/3

| Data type | StorageSize | Range |
| :--- | :--- | :--- |
|**Dictionary** 	|Unknown 	|Unknown|
|**Object** 	|4 bytes 	|Any Object reference|
|Collection 	|Unknown 	|Unknown|
|**Variant** (with numbers) 	|16 bytes 	|Any numeric value up to the range of a Double|
|Variant (with characters) 	|22 bytes + string length (24 bytes on 64-bit systems) 	|Same range as for variable-length String|
|**User-defined** (using Type) 	|Number required by elements 	|The range of each element is the same as the range of its data type.|
</script></section>
<section data-markdown><script type="text/template">
## Why should we set the data type?
- **電腦的程式碼必須載入到記憶體中才能被執行**，但是，當電源關閉，記憶體中的資料全部消失不見，因此，必須要後備儲存體存放資料
- 中央處理器讀取記憶體中的資料，並且執行程式碼，透過**資料型態的宣告，讓電腦知道處理的資料是哪種型態，要配置多少記憶體**？
- 例如：整數資料型態 (Integer)，配置 2 bytes 的記憶體，而不是 4 bytes 的記憶體，
對於工程數值的精確度要求，可以使用更長的資料型態來做計算，以達到精確度要求
- **電腦沒有減法器，整數相減，減數先取補數，兩數相加後再加 1**；例如 10 - 3 = 7, 1010 + 1100,  0110 + 1 = 0111 = 7
</script></section>
<section data-markdown><script type="text/template">
## 電腦處理整數減法
- **減數先取補數，兩數相加後再加 1**
- 例如 10 - 3 = 7, 1010 + 1100 = 0110, 0110 + 1 = 0111 = 7
	- 減數 3, 二進位是 0011, 取補數得 1100
	- 10 的二進位數字是 1010，與 1100 相加得 0110
	- 0110 再加 1 得 0111, 0111 是 7
	- 所以，10 -3 = 7
</script></section>
<section data-markdown><script type="text/template">
## Type-declaration characters
|Character |Data Type of Variable | Example|
|:--- | :--- | :--- |
|% |Integer | Quantity% |
|& |Long |China& |
|@ | Currency |Profits@ |
| ! |Single |temperature! |
|# |Double |Differential# |
| $|String (variable length)| myMessage$|
| | | |
- For example the **implicit declaration of the variable**
	- Quantity% = 10
	- China& = 100
	- myMessage$ = "Hello World"
</script></section>
<section data-markdown><script type="text/template">
## 自訂資料型態
- User-defined data types can contain one or more elements
 of a data type, an array, or **a previously defined user-defined type**.

<pre><code data-trim data-line-numbers>Type employeeInfo 	' Create user-defined type.
    ID As Integer               ' Define elements of data type.
    Name As String * 20
    Address As String * 30
    Phone As Long
    HireDate As Date
End Type
Sub createInfo()
    Dim myInfo As employeeInfo	' Declare variable.
    myInfo.ID = 1234	' Assign a value to an element.
    myInfo.Name = "Elvis Hsieh"
    myInfo.Phone = 928911199
    MsgBox myInfo.ID & myInfo.Name & myInfo.Phone, vbOKOnly, "Personal Information"
End Sub</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## VBA Keywords
- [Keywords of VBA](https://learn.microsoft.com/en-us/office/vba/language/reference/keywords-visual-basic-for-applications)
| | | | ||
|:---|:---|:---|:---|:---|
| As | Binary | ByRef | ByVal |Date |
| Else |Empty |Error |False | For|	
| Friend | Get | Input | Is | Len|	
| Let |Lock | Me | Mid	| New |
| Next |Nothing | Null	| On | Option |
| Optional | ParamArray | Print | Private | Property |
| PtrSafe | Public | Resume | Seek | Set |
| Static | Step | String | Then | Time | 
| To	 | True |WithEvents | | |
| | | | ||
- [Keywords by task](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/keywords-by-task)
and [VB Keywords](https://learn.microsoft.com/en-us/dotnet/visual-basic/language-reference/keywords/)
- vbaIntro.xlsm : b02_declareVar, b03_declareDrill module
</script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template">
# Cells, Range and Worksheet
</script></section>
<section data-markdown><script type="text/template">
## Cells and Ranges(1/2)
- 請開啟 VBE, **按 Ctrl + G 開啟"即時運算"視窗**，依序輸入下列的語法，按下 Enter
	1. Range("A1:A4").Select ↩
	1. [A1:A4].Value = 55
	2. Range("B1:D4").Value = 30
	3. Selection.ClearContents
	4. Cells.ClearContents
	5. ActiveCell.Select
	6. ?Selection.Address
	7. Print ActiveWorkbook.Name
</script></section>
<section data-markdown><script type="text/template">
## Cells and Ranges(2/2)
- 上一張投影片輸入語法以後得到的結果依序為
	1. Excel 儲存格 $A$1:$A$4 呈現被選擇的區域，顏色為灰白色(Range("A1:A4").Select)
	2. Excel 儲存格 $A$1:$A$4 資料為 55([A1:A4].Value)
	3. Excel 儲存格 $B$1:$D$4 資料為 30(Range("B1:D4").Value)
	4. Excel 儲存格 $A$1:$A$4 資料清除(Selection.ClearContents)
	5. Excel 儲存格所有資料被清除(Cells.ClearContents)
	6. 詢問目前選擇儲存格的位置(?Selection.Address)，顯示 $\text{\textdollar A}\text{\textdollar 1}$
	7. 尋問目前活頁簿的名稱(Print ActiveWorkbook.Name)，例如 vbaIntro.xlsm
</script></section>
<section data-markdown><script type="text/template">
## Try it by yourself
- **Alt + 向右鍵：開啟 Auto complete**
- **Tab 鍵：完成 Auto complete 的選擇**
	1. 輸入 de 然後按 Alt + 向右鍵(開啟 auto complete)，再按 Tab 鍵，完成 debug 指令
	2. 在 debug 後面輸入 . 然後選擇 print，再按 Tab 鍵，完成 debug.print 指令
	3. 按空白鍵以後，再輸入 ac 然後按 Alt + 向右鍵選擇 ActiveSheet
	4. 再輸入 .name 然後按 Enter
</script></section>
<section data-markdown><script type="text/template">
## Cells Operation
- Cells start with cells(1, 1)
<pre><code>Cells(4, 2).Value = 10
'Cells(0, 0).Value = 20 ' error here, starting with cells(1,1)
Cells(1, 3).Value = 30</code></pre>
- Cells (4, 2) is the same with Cells(4, B) in Excel
- Using **Evaluate function** to set the cells value
<pre><code>Application.Evaluate("a3") = "HelloWorld!"
[a4] = "elvis hsieh" ' the same as above code
[a5] = "Sum(B1:C4)"</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Range format instructions
- 設定 Range 儲存格內的字型、字型大小及顏色等 
<pre><code>Sheets.Add.name = "test"
Range("a4:d9").value = "中華文字之美"
Range("a4:d9").Font.Name = "標楷體"
Range("a4:d9").Font.Size = 20
Range("a4:d9").Font.Color = RGB(255,0,0)
Range("a4:d9").Columns.AutoFit
Range("a4:d9").ClearFormats
Sheets("test").Delete
</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Range Operation
- [Range is a object](https://learn.microsoft.com/zh-tw/office/vba/api/excel.range(object)) which have many method and properties.
<pre><code data-trim data-line-numbers>Set wb = ThisWorkbook
Set ws = wb.Worksheets(2) 'the second "elvis" sheet
Set rg = ws.range("D1:E4")
Debug.Print rg.Address
' run the below code step by step
For i = 1 To 8
	rg.Cells(i) = i
Next i
Dim rValue As Integer ' change rValue into rvalue for testing case-sensitive
rValue = 8
For j = 1 To 4
	For k = 1 To 2
		rg.Cells(j, k) = rValue
		rValue = rValue - 1
	Next k
Next j</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## What is an object?
- An object represents an element of an application, such as **a worksheet, a cell, a chart, a form, or a report**.
- You can apply one of the object's **methods or change the value of one of its properties**.
- 使用 dot(.) 來呼叫物件的方法(method)或屬性(property)
- For example
	- Range 是一個物件, Range("A1:A4").Select 語法是使用 Range 物件的 Select 方法，選取指定的 A1:A4 區域
	- Selection.ClearContents method 把目前 Selection 區域的資料清除
</script></section>
<section data-markdown><script type="text/template">
## Method, Property and Event
- **A method is an action that an object can perform(可執行的動作)**. For example, ClearContents method 清除資料
- **A property is an attribute of an object** that defines one of the object's characteristics, such as **size, color, or screen location**, or an aspect of its behavior, such as whether it is enabled or visible.
	- for example, Range("a1:a4").Font.Size = 20, Range("A1:A4").Interior.Color = RGB(255,0,0) 
- An event is an action recognized by an object, **such as clicking the mouse or pressing a key**, and for which you can write code to respond.
</script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template">
# Array
</script></section>
<section data-markdown><script type="text/template">
## Arrays(1/4)
- One-dimensional
<pre><code>Dim arrayDirect1D(2) As String
arrayDirect(0) = "A"
arrayDirect(1) = "B"
arrayDirect(2) = "C"</code></pre>
- Multi-dimensional
<pre><code>Dim arrayDirectMulti(1, 1, 2) As String
arrayDirectMulti(0, 0, 0) = "A"
arrayDirectMulti(0, 0, 1) = "B"
arrayDirectMulti(0, 0, 2) = "C"
arrayDirectMulti(0, 1, 0) = "D"</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Arrays(2/4)
- Using Array() function
<pre><code>Dim array1D As Variant 'has to be type variant
array1D = Array(1, 2, "A")
'-> array1D(0) = 1, array1D(1) = 2, array1D(2) = "A"</code></pre>
- From range
<pre><code>Dim arrayRange As Variant 'has to be type variant
arrayRange = Range("A1:C10").Value
'-> arrayRange(1,1) = value in A1
'-> arrayRange(1,2) = value in B1
'-> arrayRange(5,3) = value in C5</code></pre>
</script></section>
<section data-markdown><script type="text/template">
## Arrays(3/4)
- From range(**Range("A1:C10").Value**)
	- Putting ranges in an array **always creates a 2D array** (even if only 1 row or column)
	- **Starting at 1 and not 0, first dimension is the row** and the second the column
|  | A | B | C |
| :---: | :---: | :---: | :---: |
| 2 | (1,1) | (1,2) | (1,3) |
| 3 | (2,1) | (2,2) | (2,3) |
| 4 | (3,1) | (3,2) | (3,3) |
| 5 | (5,1) | (5,2) | (5,3) |
| ... | ... | ... | ... |
| 10 | (10,1) | (10,2) | (10,3) |
| | | | |
</script></section>
<section data-markdown><script type="text/template"></script></section>
<section data-markdown><script type="text/template"></script></section>
<section data-markdown><script type="text/template"></script></section>
<section data-markdown><script type="text/template">
## MsgBox function
- 語法： MsgBox (prompt, [ buttons, ] [ title, ] [ helpfile, context ])
<pre><code>Dim Msg, Style, Title, Help, Ctxt, Response, MyString
Msg = "Do you want to continue ?"    ' Define message.
Style = vbYesNo Or vbCritical Or vbDefaultButton2    ' Define buttons.
Title = "MsgBox Demonstration"    ' Define title.
Help = "DEMO.HLP"    ' Define Help file.
Ctxt = 1000    ' Define topic context. 
		' Display message.
Response = MsgBox(Msg, Style, Title, Help, Ctxt)
If Response = vbYes Then    ' User chose Yes.
	MyString = "Yes"    ' Perform some action.
Else    ' User chose No.
	MyString = "No"    ' Perform some action.
End If</code></pre>
- Reference to [MsgBox function](https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/msgbox-function)
</script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template"></script></section>
</section><!--end block-->

<section><!--start block-->
<section data-markdown><script type="text/template">
## Boolean data type
- A data type with only two possible values, True (-1) or False (0). 
- Boolean variables are stored as 16-bit (2-byte) numbers
</script></section>
<section data-markdown><script type="text/template">
## EOF function
-  EOF function to detect the end of a file. This example assumes that myFile.txt is a text file with a few lines of text.
<pre><code>Public Sub oneChar()
Dim MyChar
Open "myFile.txt" For Input As #1    ' Open ./myFile.txt file for input.
Do While Not EOF(1)    ' Check for end of file.
	' MyChar = Input(1, #1)  ' Get one character.
	Line Input #1, MyChar    ' Read line of data.
	Debug.Print MyChar    ' Print to the Immediate window.
Loop
Close #1    ' Close file.
End Sub
' myFile.txt contents
' Hi, runner hsieh
' I am a programmer.
</code></pre>
</script></section>
<section data-markdown><script type="text/template"></script></section>
<section data-markdown><script type="text/template"></script></section>
<section data-markdown><script type="text/template"></script></section>
</section><!--end block-->
	
</div>
</div>

<script src="/revealjs/lib/js/head.min.js"></script>
<script src="/revealjs/dist/reveal.js"></script>
<script src="/revealjs/plugin/zoom/zoom.js"></script>
<script src="/revealjs/plugin/notes/notes.js"></script>
<script src="/revealjs/plugin/search/search.js"></script>
<script src="/revealjs/plugin/markdown/markdown.js"></script>
<script src="/revealjs/plugin/highlight/highlight.js"></script>
<script src="/revealjs/plugin/menu/menu.js"></script>
<script src="/revealjs/plugin/math/math.js"></script>
<script src="/revealjs/plugin/chalkboard/plugin.js"></script>
<script src="/revealjs/plugin/customcontrols/plugin.js"></script>
<script src="/revealjs/plugin/animate/svg.min.js"></script>
<script src="/revealjs/plugin/animate/plugin.js"></script>

<script>
Reveal.initialize({
controls: true,
progress: true,
history: true,
center: true,
slideNumber: true,
mouseWheel: true,
transition: 'fade', // none/fade/slide/convex/concave/zoom

menu: {
	side: 'left',
	width: 'normal',
	numbers: false,
	titleSelector: 'h1, h2, h3, h4, h5, h6',
	useTextContentForMissingTitles: false,
	hideMissingTitles: false,
	markers: true,
	custom: true,
	themes: true,
	themesPath: '/revealjs/dist/theme/',
	transitions: true,
	openButton: true,
	openSlideNumber: false,
	keyboard: true,
	sticky: false,
	autoOpen: true,
	delayInit: false,
	openOnInit: false,
	loadIcons: true,
	
	custom: [
			{ title: 'TOC', icon: '<i class="fa fa-external-link-alt">', src: 'links.html' },
			{ title: 'About', icon: '<i class="fa fa-info">', content: '<p>Slides for teaching Office Suite Softwar</p>' }
	]
},

customcontrols: {
	controls: [
	{
		id: 'toggle-overview',
		title: 'Toggle overview (O)',
		icon: '<i class="fa fa-th"></i>',
		action: 'Reveal.toggleOverview();'
	},
	{ icon: '<i class="fa fa-pen-square"></i>',
		title: 'Toggle chalkboard (B)',
		action: 'RevealChalkboard.toggleChalkboard();'
	},
	{ icon: '<i class="fa fa-pen"></i>',
		title: 'Toggle notes canvas (C)',
		action: 'RevealChalkboard.toggleNotesCanvas();'
	}
	]
},

toolbar: {
	// Specifies where the toolbar will be shown: 'top' or 'bottom'
	position: 'bottom',

	// Add button to toggle fullscreen mode for the presentation
	fullscreen: true,

	// Add button to toggle the overview mode on and off
	overview: true,

	// Add button to pause (hide) the presentation display
	pause: true,

	// Add button to show the speaker notes
	notes: false,

	// Add button to show the help overlay
	help: false,

	// If true, the reveal.js-menu will be moved into the toolbar.
	// Set to false to leave the menu on its own.
	captureMenu: true,

	// If true, the playback control will be moved into the toolbar.
	// This is only relevant if the presentation is configured to autoSlide.
	// Set to false to leave the menu on its own.
	capturePlaybackControl: true,

	// By default the menu will load it's own font-awesome library
	// icons. If your presentation needs to load a different
	// font-awesome library the 'loadIcons' option can be set to false
	// and the menu will not attempt to load the font-awesome library.
	loadIcons: true
},

// Optional reveal.js plugins
plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight, RevealAnimate, RevealMenu, RevealCustomControls, RevealChalkboard, RevealMath.KaTeX ],

dependencies: [
//{ src: '/revealjs/plugin/toolbar/toolbar.js' }
]
});

</script>

</body>
</html>
